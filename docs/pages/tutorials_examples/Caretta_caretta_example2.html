<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="This vignette provides a detailed example of fitting a single-species distribution model within a user-defined region.">

<title>Example 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo_glossa.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo_glossa_text.png" alt="GLOSSA logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../get_started.html" rel="" target="">
 <span class="menu-text">Get started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index2.html" rel="" target="">
 <span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pages/tutorials_examples/index.html" rel="" target="">
 <span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../course.html" rel="" target="">
 <span class="menu-text">Course</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../how_to_cite.html" rel="" target="">
 <span class="menu-text">Cite us</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contact_us.html" rel="" target="">
 <span class="menu-text">Contact us</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="../../index2.html" rel="" target="">
 <span class="dropdown-text">Report a bug</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../index2.html" rel="" target="">
 <span class="dropdown-text">FAQs</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <a href="https://github.com/jmestret/glossa" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data preparation</a>
  <ul class="collapse">
  <li><a href="#download-occurrence-data" id="toc-download-occurrence-data" class="nav-link" data-scroll-target="#download-occurrence-data">Download occurrence data</a></li>
  <li><a href="#download-environmental-data" id="toc-download-environmental-data" class="nav-link" data-scroll-target="#download-environmental-data">Download environmental data</a></li>
  <li><a href="#climate-projections-ssp1-2.6-and-ssp5-8.5" id="toc-climate-projections-ssp1-2.6-and-ssp5-8.5" class="nav-link" data-scroll-target="#climate-projections-ssp1-2.6-and-ssp5-8.5">Climate projections: SSP1 2.6 and SSP5 8.5</a></li>
  <li><a href="#study-area-polygon" id="toc-study-area-polygon" class="nav-link" data-scroll-target="#study-area-polygon">Study area polygon</a></li>
  </ul></li>
  <li><a href="#glossa-modeling" id="toc-glossa-modeling" class="nav-link" data-scroll-target="#glossa-modeling">GLOSSA modeling</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#computation-time" id="toc-computation-time" class="nav-link" data-scroll-target="#computation-time">Computation time</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jmestret/glossa/edit/main/pages/tutorials_examples/Caretta_caretta_example2.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jmestret/glossa/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Example 2</h1>
<p class="subtitle lead">Distribution of the Loggerhead Sea Turtle in the Mediterranean Sea</p>
</div>

<div>
  <div class="description">
    This vignette provides a detailed example of fitting a single-species distribution model within a user-defined region.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This vignette provides a detailed example of fitting a single-species distribution model within a user-defined region. We will walk through the steps of obtaining occurrence data, gathering environmental data, and defining the study area using a polygon. The example focuses on the distribution of the loggerhead sea turtle (<em>Caretta caretta</em>) in the Mediterranean Sea. Occurrence data will be retrieved from GBIF for the years 2000 to 2019, and environmental data from Bio-ORACLE v3.0 (Assis <em>et al.</em>, 2024). We will use GLOSSA to fit a species distribution model and project it under different future climate scenarios.</p>
<p>To get started, we load the <strong>glossa</strong> package, as well as <strong>terra</strong> (Hijmans, 2024) and <strong>sf</strong> (Pebesma, 2018) to work with spatial rasters and vector data. We also load <strong>rgbif</strong> (Chamberlain, 2017) and <strong>biooracler</strong> (Fernandez Bejarano and Salazar, 2024) for downloading species occurrences and environmental data, respectively. Additionally, the <strong>dplyr</strong> (Wickham <em>et al</em>., 2023) package will be used for data manipulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glossa)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgbif)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biooracler)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data preparation</h2>
<section id="download-occurrence-data" class="level3">
<h3 class="anchored" data-anchor-id="download-occurrence-data">Download occurrence data</h3>
<p>We will download occurrence data for <em>Caretta caretta</em> in the Mediterranean Sea using the GBIF API. The data will be filtered by date and geographic boundaries to fit the Mediterranean region and align with the temporal scale of the environmental data from Bio-ORACLE. To use the GBIF API, you need to have a registered account (<code>user</code>, <code>pwd</code>, and <code>email</code>). First, we retrieve the taxon key for <em>C. caretta</em>, and then use <code>occ_download()</code> from the <code>rgbif</code> package to download the occurrences. To restrict the download to the Mediterranean Sea, we use the <code>pred_within()</code> argument and define a polygon of interest (<code>"POLYGON ((-10 28, 38 28, 38 51, -10 51, -10 28))"</code>). Since Bio-ORACLE provides environmental layers in decadal steps, we limit the occurrence data to points between 2000 and 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to retrieve taxon key from scientific name</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>get_taxon_key <span class="ot">&lt;-</span> <span class="cf">function</span>(name) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> rgbif<span class="sc">::</span><span class="fu">occ_search</span>(<span class="at">scientificName =</span> name, <span class="at">hasCoordinate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(result<span class="sc">$</span>data)) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">as.character</span>(result<span class="sc">$</span>data<span class="sc">$</span>taxonKey[<span class="dv">1</span>]))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"No taxon key found for"</span>, name))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define GBIF credentials and species information</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>user <span class="ot">&lt;-</span> <span class="st">"&lt;gbif username&gt;"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>pwd <span class="ot">&lt;-</span> <span class="st">"&lt;password&gt;"</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>email <span class="ot">&lt;-</span> <span class="st">"&lt;gbif mail&gt;"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>taxon_key <span class="ot">&lt;-</span> <span class="fu">get_taxon_key</span>(<span class="st">"Caretta caretta"</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Download GBIF occurrence data</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>request_id <span class="ot">&lt;-</span> <span class="fu">as.character</span>(rgbif<span class="sc">::</span><span class="fu">occ_download</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  rgbif<span class="sc">::</span><span class="fu">pred</span>(<span class="st">"taxonKey"</span>, taxon_key),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  rgbif<span class="sc">::</span><span class="fu">pred</span>(<span class="st">"hasCoordinate"</span>, <span class="cn">TRUE</span>),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  rgbif<span class="sc">::</span><span class="fu">pred_within</span>(<span class="st">"POLYGON ((-10 28, 38 28, 38 51, -10 51, -10 28))"</span>),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  rgbif<span class="sc">::</span><span class="fu">pred</span>(<span class="st">"occurrenceStatus"</span>, <span class="st">"PRESENT"</span>),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  rgbif<span class="sc">::</span><span class="fu">pred_gte</span>(<span class="st">"YEAR"</span>, <span class="dv">2000</span>),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  rgbif<span class="sc">::</span><span class="fu">pred_lte</span>(<span class="st">"YEAR"</span>, <span class="dv">2019</span>),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"SIMPLE_CSV"</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">user =</span> user,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">pwd =</span> pwd,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">email =</span> email</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> rgbif<span class="sc">::</span><span class="fu">occ_download_wait</span>(request_id)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (response<span class="sc">$</span>status <span class="sc">==</span> <span class="st">"SUCCEEDED"</span>){</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".csv"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(response<span class="sc">$</span>downloadLink, temp, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  caretta <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">unz</span>(temp, <span class="fu">paste0</span>(response<span class="sc">$</span>key, <span class="st">".csv"</span>)),</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                        <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have the dataset, we prepare it to fit the GLOSSA format. For this, we extract the required record locations (<em>decimalLongitude</em> and <em>decimalLatitude</em>) and assign a <em>timestamp</em> for each record. As Bio-ORACLE provides environmental layers for two decades (2000s and 2010s), we assign points from 2000 to 2009 to the first time period and points from 2010 to 2019 to the second time period. We then create a presence/absence column (<em>pa</em>), setting all downloaded records as presences. Finally, we save the file as a tab-separated CSV and retrieve the DOI of the downloaded data from GBIF (GBIF.org, 2024).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data for modeling</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate timestamp in two decades to fit Bio-ORACLE format (2000s and 2010s)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>caretta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">decimalLongitude =</span> caretta<span class="sc">$</span>decimalLongitude,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">decimalLatitude =</span> caretta<span class="sc">$</span>decimalLatitude,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timestamp =</span> <span class="fu">ifelse</span>(caretta<span class="sc">$</span>year <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2009</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pa =</span> <span class="dv">1</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>caretta <span class="ot">&lt;-</span> caretta[<span class="fu">complete.cases</span>(caretta),]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the data</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(caretta, <span class="at">file =</span> <span class="st">"data/Caretta_caretta_occ.csv"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">dec =</span> <span class="st">"."</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Get citation for the downloaded data</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>citation <span class="ot">&lt;-</span> rgbif<span class="sc">::</span><span class="fu">gbif_citation</span>(request_id)<span class="sc">$</span>download</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>citation</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># GBIF Occurrence Download https://doi.org/10.15468/dl.es7562</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessed from R via rgbif (https://github.com/ropensci/rgbif) on 2024-08-27</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-environmental-data" class="level3">
<h3 class="anchored" data-anchor-id="download-environmental-data">Download environmental data</h3>
<p>Bio-ORACLE provides environmental layers at a spatial resolution of 0.05 degrees and in decadal steps. We will download environmental variables such as ocean surface temperature (<code>thetao</code> in <span class="math inline">\(^{\circ}\)</span>C), primary productivity (<code>phyc</code> in <span class="math inline">\(\text{mmol} \cdot \text{m}^{-3}\)</span>), and salinity (<code>so</code>). Bathymetry (<code>bat</code>) will be obtained from the ETOPO 2022 Global Relief Model by NOAA (<a href="https://www.ncei.noaa.gov/products/etopo-global-relief-model" class="uri">https://www.ncei.noaa.gov/products/etopo-global-relief-model</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define temporal and spatial constraints</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"2000-01-01T00:00:00Z"</span>, <span class="st">"2010-01-01T00:00:00Z"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">28</span>, <span class="dv">51</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">38</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>constraints <span class="ot">=</span> <span class="fu">list</span>(time, longitude, latitude)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(constraints) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Download environmental layers from Bio-Oracle</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>thetao_hist <span class="ot">&lt;-</span> <span class="fu">download_layers</span>(<span class="st">"thetao_baseline_2000_2019_depthsurf"</span>, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"thetao_mean"</span>, constraints)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>phyc_hist <span class="ot">&lt;-</span> <span class="fu">download_layers</span>(<span class="st">"phyc_baseline_2000_2020_depthsurf"</span>, </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"phyc_mean"</span>, constraints)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>so_hist <span class="ot">&lt;-</span> <span class="fu">download_layers</span>(<span class="st">"so_baseline_2000_2019_depthsurf"</span>, </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"so_mean"</span>, constraints)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Download bathymetry data</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://www.ngdc.noaa.gov/thredds/fileServer/global/ETOPO2022/60s/60s_bed_elev_netcdf/ETOPO_2022_v1_60s_N90W180_bed.nc"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">"data/ETOPO_2022_v1_60s_N90W180_bed.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will prepare the downloaded environmental data and save it in the directory structure required by GLOSSA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/fit_layers"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare environmental variables for modeling</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>env_var <span class="ot">&lt;-</span> <span class="fu">list</span>(thetao_hist, so_hist, phyc_hist)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(env_var) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"thetao"</span>, <span class="st">"so"</span>, <span class="st">"phyc"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(env_var)) {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  var_dir <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"data/fit_layers/"</span>, <span class="fu">names</span>(env_var)[i])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(var_dir)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    env_var[[i]][[<span class="dv">1</span>]], </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(var_dir, <span class="st">"/"</span>, <span class="fu">names</span>(env_var)[i], <span class="st">"_1.tif"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    env_var[[i]][[<span class="dv">2</span>]],</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(var_dir, <span class="st">"/"</span>, <span class="fu">names</span>(env_var)[i], <span class="st">"_2.tif"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean up auxiliary files generated by terra - Optional</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  aux_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(var_dir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.aux</span><span class="sc">\\</span><span class="st">.json$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(aux_files)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare bathymetry data</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>bat <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data/ETOPO_2022_v1_60s_N90W180_bed.nc"</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>bat <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>bat <span class="co"># Change sign from elvation to bathymetry</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate to match resolution with Bio-ORACLE layers</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>bat <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">aggregate</span>(bat, <span class="at">fact =</span> <span class="dv">3</span>, <span class="at">fun =</span> <span class="st">"mean"</span>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(terra<span class="sc">::</span><span class="fu">ext</span>(env_var[[<span class="dv">1</span>]]), <span class="at">res =</span> terra<span class="sc">::</span><span class="fu">res</span>(env_var[[<span class="dv">1</span>]]))</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>bat <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(bat, r)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/fit_layers/bat"</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(bat, <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"data/fit_layers/bat/bat_"</span>, i, <span class="st">".tif"</span>))</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Zip all prepared layers</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="fu">zip</span>(<span class="at">zipfile =</span> <span class="st">"data/fit_layers.zip"</span>, <span class="at">files =</span> <span class="st">"data/fit_layers"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="climate-projections-ssp1-2.6-and-ssp5-8.5" class="level3">
<h3 class="anchored" data-anchor-id="climate-projections-ssp1-2.6-and-ssp5-8.5">Climate projections: SSP1 2.6 and SSP5 8.5</h3>
<p>We will now download climate projections for SSP1 2.6 (sustainable development scenario where global CO2 emissions are strongly reduced but less rapidly) and SSP5 8.5 (a high emissions scenario) scenarios, and prepare the data for model projection.</p>
<section id="ssp1-2.6" class="level4">
<h4 class="anchored" data-anchor-id="ssp1-2.6">SSP1 2.6</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SSP1 2.6 projections constraints</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"2020-01-01T00:00:00Z"</span>, <span class="st">"2090-01-01T00:00:00Z"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">28</span>, <span class="dv">51</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">38</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>constraints <span class="ot">=</span> <span class="fu">list</span>(time, longitude, latitude)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(constraints) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>env_var_ssp126 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">thetao_ssp126 =</span> <span class="fu">download_layers</span>(<span class="st">"thetao_ssp126_2020_2100_depthsurf"</span>, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"thetao_mean"</span>, constraints),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">so_ssp126 =</span> <span class="fu">download_layers</span>(<span class="st">"so_ssp126_2020_2100_depthsurf"</span>, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"so_mean"</span>, constraints),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">phyc_ssp126 =</span> <span class="fu">download_layers</span>(<span class="st">"phyc_ssp126_2020_2100_depthsurf"</span>, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"phyc_mean"</span>, constraints)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(env_var_ssp126) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"thetao"</span>, <span class="st">"so"</span>, <span class="st">"phyc"</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/proj_ssp126"</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(env_var_ssp126)) {</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  var_dir <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"data/proj_ssp126/"</span>, <span class="fu">names</span>(env_var_ssp126)[i])</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(var_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    env_var_ssp126[[i]][[<span class="dv">1</span>]], </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(var_dir, <span class="st">"/"</span>, <span class="fu">names</span>(env_var_ssp126)[i], <span class="st">"_1.tif"</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    env_var_ssp126[[i]][[<span class="dv">4</span>]], </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(var_dir, <span class="st">"/"</span>, <span class="fu">names</span>(env_var_ssp126)[i], <span class="st">"_2.tif"</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    env_var_ssp126[[i]][[<span class="dv">8</span>]], </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(var_dir, <span class="st">"/"</span>, <span class="fu">names</span>(env_var_ssp126)[i], <span class="st">"_3.tif"</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean up auxiliary files</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  aux_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(var_dir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.aux</span><span class="sc">\\</span><span class="st">.json$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(aux_files)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare bathymetry data for SSP1 2.6</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/proj_ssp126/bat"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(bat, <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"data/proj_ssp126/bat/bat_"</span>, i, <span class="st">".tif"</span>))</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Zip the data</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="fu">zip</span>(<span class="at">zipfile =</span> <span class="st">"data/proj_ssp126.zip"</span>, <span class="at">files =</span> <span class="st">"data/proj_ssp126"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ssp5-8.5" class="level4">
<h4 class="anchored" data-anchor-id="ssp5-8.5">SSP5 8.5</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SSP5 8.5 projections constraints</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"2020-01-01T00:00:00Z"</span>, <span class="st">"2090-01-01T00:00:00Z"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">28</span>, <span class="dv">51</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">38</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>constraints <span class="ot">=</span> <span class="fu">list</span>(time, longitude, latitude)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(constraints) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>env_var_ssp585 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">thetao_ssp585 =</span> <span class="fu">download_layers</span>(<span class="st">"thetao_ssp585_2020_2100_depthsurf"</span>, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"thetao_mean"</span>, constraints),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">so_ssp585 =</span> <span class="fu">download_layers</span>(<span class="st">"so_ssp585_2020_2100_depthsurf"</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"so_mean"</span>, constraints),</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">phyc_ssp585 =</span> <span class="fu">download_layers</span>(<span class="st">"phyc_ssp585_2020_2100_depthsurf"</span>, </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"phyc_mean"</span>, constraints)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(env_var_ssp585) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"thetao"</span>, <span class="st">"so"</span>, <span class="st">"phyc"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/proj_ssp585"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(env_var_ssp585)) {</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  var_dir <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"data/proj_ssp585/"</span>, <span class="fu">names</span>(env_var_ssp585)[i])</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(var_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    env_var_ssp585[[i]][[<span class="dv">1</span>]], </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(var_dir, <span class="st">"/"</span>, <span class="fu">names</span>(env_var_ssp585)[i], <span class="st">"_1.tif"</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    env_var_ssp585[[i]][[<span class="dv">4</span>]], </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(var_dir, <span class="st">"/"</span>, <span class="fu">names</span>(env_var_ssp585)[i], <span class="st">"_2.tif"</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    env_var_ssp585[[i]][[<span class="dv">8</span>]], </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(var_dir, <span class="st">"/"</span>, <span class="fu">names</span>(env_var_ssp585)[i], <span class="st">"_3.tif"</span>)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean up auxiliary files</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  aux_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(var_dir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.aux</span><span class="sc">\\</span><span class="st">.json$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.remove</span>(aux_files)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare bathymetry data for SSP5 8.5</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/proj_ssp585/bat"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(bat, <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"data/proj_ssp585/bat/bat_"</span>, i, <span class="st">".tif"</span>))</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Zip the data</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="fu">zip</span>(<span class="at">zipfile =</span> <span class="st">"data/proj_ssp585.zip"</span>, <span class="at">files =</span> <span class="st">"data/proj_ssp585"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="study-area-polygon" class="level3">
<h3 class="anchored" data-anchor-id="study-area-polygon">Study area polygon</h3>
<p>To define the study area, we downloaded a polygon representing the Mediterranean Sea, which restricts the analysis to this region as the environmental layers extend beyond it. The shapefile was obtained from the <a href="https://www.marineregions.org/">Marine Regions</a> repository. The specific download link for the Mediterranean Sea polygon can be found <a href="https://www.marineregions.org/gazetteer.php?p=details&amp;id=1905">here</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/med_sea_poly.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Polygon defining the study area for the Mediterranean Sea. This polygon restricts the analysis to the Mediterranean region, considering the extent of the environmental layers. Image obtained from the Marine Regions website.</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tmpdir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>zip_contents <span class="ot">&lt;-</span> utils<span class="sc">::</span><span class="fu">unzip</span>(<span class="st">"data/iho.zip"</span>, <span class="at">unzip =</span> <span class="fu">getOption</span>(<span class="st">"unzip"</span>), <span class="at">exdir =</span> tmpdir)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>med_sea <span class="ot">&lt;-</span> <span class="fu">list.files</span>(tmpdir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.shp$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_read</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>med_sea <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_geometry</span>(med_sea[[<span class="dv">2</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(med_sea) <span class="ot">&lt;-</span> <span class="st">"epsg:4326"</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(med_sea, <span class="st">"data/mediterranean_sea.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="glossa-modeling" class="level2">
<h2 class="anchored" data-anchor-id="glossa-modeling">GLOSSA modeling</h2>
<p>With the data prepared and formatted for the GLOSSA framework, we use the <code>glossa::run_glossa()</code> function to launch the GLOSSA Shiny app for species distribution modeling and projection under different climate scenarios.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">run_glossa</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Upload the occurrence file for <em>C. caretta</em> and the environmental layers for model fitting and projection scenarios. For habitat suitability analysis, select the <em>Model fitting</em> and <em>Model projection</em> options from the <em>Suitable habitat</em> model. Enable <em>Variable importance</em> in the <em>Others</em> section to check the decrease of the F-score.</p>
<p>In the advanced options, set the following parameters: thinning precision to 2, standardize environmental data, and enlarge the polygon by 0.01 degrees to account for the lower resolution of the polygon and ensure the boundaries match properly -previously, many points near the coast were lost due to an insufficient buffer size-. Select the BART (Chipman, <em>et al</em>., 2010; Dorie, 2024) model and set the seed to 5648 for reproducibility.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/example2_analysis_options.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Analysis options set in GLOSSA for modeling the distribution of <em>Caretta caretta</em>.</figcaption>
</figure>
</div>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>Once the analysis is completed, we observe occurrence records that were excluded due to being outside the study area or too close to other points (orange points in Figure 3), as we applied a thinning precision of 2. We are left with 5572 presence points and an equal number of pseudo-absences.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/caretta_presence_validation.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Validation of presence points for <em>Caretta caretta</em>. Points are filtered based on their proximity and location relative to the study area, resulting in 5572 presence records (blue points).</figcaption>
</figure>
</div>
<p>The model summary indicates a decent predictive capacity with an AUC of 0.9 and an F-score of 0.8 The distribution of fitted values can also be explored. Note that the model was fitted using randomly generated pseudo-absences rather than real absences.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/caretta_model_summary.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Summary of the fitted model for <em>Caretta caretta</em>. From left to right: the ROC curve, a plot representing the confusion matrix with the associated probabilities, and the distribution on the fitted values.</figcaption>
</figure>
</div>
<p>We can also determine which predictors play a more significant role in predicting the outcome by examining the variable importance plot. This plot shows the decrease in model F-score using permutation feature importance, which measures the increase in prediction error after shuffling the predictor values. We see that the most important variable is the sea surface temperature followed by the bathymetry. Sea turtles live their entire lives in the ocean, but they migrate to nest on coastal land, with their sex being determined by the temperature during incubation (Mancino <em>et al</em>., 2022).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/caretta_var_imp.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Variable importance plot using the F-score as the performance metric</figcaption>
</figure>
</div>
<p>For the climate projections, there is a predicted decrease of 16.4% in suitable habitat area (<span class="math inline">\(\text{km}^2\)</span>) in the SSP1-2.6 scenario and about 78.2% in the SSP5-8.5 scenario from the 2020s to the 2090s. The western Mediterranean and the Adriatic Sea are projected to have relatively better habitat suitability.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/caretta_projections.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Projected changes in suitable habitat for <em>Caretta caretta</em> under different climate scenarios.</figcaption>
</figure>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This example shows how GLOSSA can be used to model the distribution of <em>Caretta caretta</em> in the Mediterranean Sea. The steps included downloading occurrence data from GBIF, obtaining environmental layers from Bio-ORACLE, and preparing the data for model fitting and projections under various climate change scenarios.</p>
</section>
<section id="computation-time" class="level2">
<h2 class="anchored" data-anchor-id="computation-time">Computation time</h2>
<p>The analysis was performed on a single Windows 11 machine equipped with 64 GB of RAM and an Intel(R) Core(TM) i7-1165G7 processor. This processor features 4 cores and 8 threads, with a base clock speed of 2.80 GHz. The following table summarizes the computation times for various stages of the GLOSSA analysis. This provides an overview of the computational resources required for each step in the analysis.</p>
<p align="center">
<b>Table 1.</b> Computation times for different stages of the GLOSSA analysis for the loggerhead sea turtle (<i>Caretta caretta</i>) in the Mediterranean Sea.
</p>
<table class="table">
<thead>
<tr class="header">
<th><strong>Task</strong></th>
<th><strong>Execution Time</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Loading input data</td>
<td>33.65 secs</td>
</tr>
<tr class="even">
<td>Processing P/A coordinates</td>
<td>0.21 secs</td>
</tr>
<tr class="odd">
<td>Processing covariate layers</td>
<td>9.80 secs</td>
</tr>
<tr class="even">
<td>Building model matrix</td>
<td>12.01 secs</td>
</tr>
<tr class="odd">
<td>Fitting native range models</td>
<td>0.232 mins</td>
</tr>
<tr class="even">
<td>Variable importance (native range)</td>
<td>8.31 mins</td>
</tr>
<tr class="odd">
<td>P/A cutoff (native range)</td>
<td>0.191 mins</td>
</tr>
<tr class="even">
<td>Projections on fit layers (native range)</td>
<td>9.84 mins</td>
</tr>
<tr class="odd">
<td>Native range projections</td>
<td>9.47 mins</td>
</tr>
<tr class="even">
<td>Native range</td>
<td>19.74 mins</td>
</tr>
<tr class="odd">
<td>Fitting suitable habitat models</td>
<td>0.232 mins</td>
</tr>
<tr class="even">
<td>Variable importance (suitable habitat)</td>
<td>8.31 mins</td>
</tr>
<tr class="odd">
<td>P/A cutoff (suitable habitat)</td>
<td>0.191 mins</td>
</tr>
<tr class="even">
<td>Projections on fit layers (suitable habitat)</td>
<td>9.84 mins</td>
</tr>
<tr class="odd">
<td>Suitable habitat projections</td>
<td>9.47 mins</td>
</tr>
<tr class="even">
<td>Habitat suitability</td>
<td>0.006 mins</td>
</tr>
<tr class="odd">
<td>Suitable habitat</td>
<td>19.74 mins</td>
</tr>
<tr class="even">
<td>Computing functional responses</td>
<td>13.35 mins</td>
</tr>
<tr class="odd">
<td>Cross-validation</td>
<td>4.19 mins</td>
</tr>
<tr class="even">
<td>Model summary</td>
<td>0.18 mins</td>
</tr>
<tr class="odd">
<td><strong>Total GLOSSA analysis</strong></td>
<td><strong>38.39 mins</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><p>Assis, J., Fernández Bejarano, S. J., Salazar, V. W., Schepers, L., Gouvea, L., Fragkopoulou, E., … &amp; De Clerck, O. (2024). Bio‐ORACLE v3. 0. Pushing marine data layers to the CMIP6 Earth System Models of climate change research. <em>Global Ecology and Biogeography, 33</em>(4), e13813.</p></li>
<li><p>Chamberlain, S. (2017). <em>rgbif: Interface to the Global Biodiversity Information Facility API</em>. R package version 0.9.8. <a href="https://CRAN.R-project.org/package=rgbif" class="uri">https://CRAN.R-project.org/package=rgbif</a></p></li>
<li><p>Chipman, H. A., George, E. I., &amp; McCulloch, R. E. (2010). <em>BART: Bayesian additive regression trees</em>.</p></li>
<li><p>Dorie V (2024). <em>dbarts: Discrete Bayesian Additive Regression Trees Sampler</em>. R package version 0.9-28, <a href="https://CRAN.R-project.org/package=dbarts" class="uri">https://CRAN.R-project.org/package=dbarts</a>.</p></li>
<li><p>Fernandez-Bejarano, S. J. &amp; Salazar, V. W. (2024). <em>biooraclee: R package to access Bio-Oracle data via ERDDAP</em>. R package version 0.0.0.9, <a href="https://github.com/bio-oracle/biooracler" class="uri">https://github.com/bio-oracle/biooracler</a></p></li>
<li><p>GBIF.org (26 August 2024) GBIF Occurrence Download <a href="https://doi.org/10.15468/dl.es7562" class="uri">https://doi.org/10.15468/dl.es7562</a></p></li>
<li><p>Hijmans, R. (2024). <em>terra: Spatial Data Analysis</em>. R package version 1.7-81, <a href="https://rspatial.github.io/terra/" class="uri">https://rspatial.github.io/terra/</a>, <a href="https://rspatial.org/" class="uri">https://rspatial.org/</a>.</p></li>
<li><p>Mancino, C., Canestrelli, D., &amp; Maiorano, L. (2022). Going west: Range expansion for loggerhead sea turtles in the Mediterranean Sea under climate change. Global Ecology and Conservation, 38, e02264.</p></li>
<li><p>Pebesma E (2018). <em>Simple Features for R: Standardized Support for Spatial Vector Data</em>. The R Journal, 10(1), 439–446. <a href="https://doi.org/10.32614/RJ-2018-009">doi:10.32614/RJ-2018-009</a>.</p></li>
<li><p>Wickham H, François R, Henry L, Müller K &amp; Vaughan D (2023). <em>dplyr: A Grammar of Data Manipulation.</em> R package version 1.1.4, <a href="https://github.com/tidyverse/dplyr" class="uri">https://github.com/tidyverse/dplyr</a>, <a href="https://dplyr.tidyverse.org" class="uri">https://dplyr.tidyverse.org</a>.</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Developed by <a href="https://x.com/iMARES_group"><img src="images/logo_imares.png" class="img-fluid" alt="iMARES" width="65"></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>